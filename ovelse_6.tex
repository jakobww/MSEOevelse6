\documentclass[a4paper, 11pt, article,oneside,openany]{memoir} %A4 papir, skrift 11, artikel, ensidet print, kapitel kan starte på alle sider

% Sætter horisontal og vertikale margener
\usepackage[paper=a4paper,%
hmargin=1.5in,%
vmargin=0.9in
]{geometry}

% Font encoding og sprog
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}

\usepackage{siunitx}

\sisetup{group-separator = {,}}
\sisetup{per-mode=fraction}

\DeclareSIUnit{\sqrthz}{\ensuremath{\sqrt{\text{\hertz}}}}
\DeclareSIUnit{\voltnoise}{\volt\per\sqrthz}
\DeclareSIUnit{\amperenoise}{\ampere\per\sqrthz}

\usepackage[danish]{babel} % bedre orddeling, minimum to tegn før og efter deling
\usepackage{lmodern}  					% gør  pænere
\usepackage{microtype} 					% laver micro ændringer i text for at udgå luft og orddeling



% Farvepakker
\usepackage[svgnames,dvipsnames,x11names]{xcolor}

% Visning af kildekode
\usepackage{listings}

\lstset{ %
	backgroundcolor=\color{white}, 	% Baggrundsfarve
	basicstyle=\tiny,        			% Tekststørrelse
	breakatwhitespace=true,        		% Kun linjeskift ved mellemrum
	breaklines=true,                 		% Orddeling til
	captionpos=b,                    		% Caption under listing
	commentstyle=\color{mygreen},    	% kommentar farve
	extendedchars=true,              		% lets you use non-ASCII characters; for 8-bits encodings only, does not work with UTF-8
	frame=single,	                   		% Ramme omkring kildekode
	keepspaces=true,                 		% beholder mellemrum (indentation)
	keywordstyle=\color{blue},      	 	% keyword farve
	numbers=left,                    		% Placering af linjenumre (none, left, right)
	numbersep=5pt,                   		% Afstand til linjrenumre
	numberstyle=\tiny\color{mygray}, 	% Linjenummer tekststil
	showspaces=false,                		% show spaces everywhere adding particular underscores; it overrides 'showstringspaces'
	stepnumber=1,                    		% Hver linje har nummer
	tabsize=4,	                   		% Sætter default tabsize til 4 mellemrum
	title=\lstname                   		% filnavn som caption, hvis ikke andet er angivet
}

\usepackage{xcolor}% provides \colorlet
\usepackage{fixme}
\fxsetup{
	status=draft,
	author=,
	layout=inline,
	theme=color
}

\definecolor{fxnote}{rgb}{0.8000,0.0000,0.0000}
% define the background colour:
\colorlet{fxnotebg}{yellow}

% refedine the layout macro:
\makeatletter
\renewcommand*\FXLayoutInline[3]{%
	\@fxdocolon {#3}{%
		\@fxuseface {inline}%
		\colorbox{fx#1bg}{\color {fx#1}\ignorespaces #3\@fxcolon #2}}}
\makeatother

% Captions og referencer
\usepackage{caption}
\usepackage[danish]{cleveref}

% Figurer og floats
\usepackage[]{graphicx}
\graphicspath{{figurer/}}
\usepackage[section]{placeins}


% Tabeller
\usepackage{array}
\usepackage{booktabs}
\usepackage{threeparttable}
\usepackage[tableposition=top]{caption}

\setlength{\heavyrulewidth}{1.5pt}
\setlength{\abovetopsep}{4pt}

%matematik
\usepackage[]{amsmath}
\usepackage{amssymb,bm}
\usepackage{mathtools}
\DeclarePairedDelimiter{\abs}{\lvert}{\rvert}

\newcommand{\tsub}[1]{_{\textup{#1}}}

\newcommand{\omegaG}{\omega_{\textup{G}}}
\newcommand{\omegaGs}{\frac{\omegaG}{s}}

\newcommand{\pahz}{\frac{\si{\pico\ampere}}{\sqrt{\si{\hertz}}}}

\setsubsecheadstyle{\Large\bfseries}
\setsubsubsecheadstyle{\normalsize\bfseries}

%%% BILLEDE BREDDE
\newcommand{\plotwidth}{0.95}

% BEGIN: DSD Top Macro — [Øvelsesnummer, navn]
\newcommand{\msetop}[2]{
	\noindent
	\setlength\fboxsep{5mm}
	\setlength\fboxrule{0.75mm}
	\fcolorbox{DeepSkyBlue4}{white}{%
		\begin{minipage}{\textwidth - 2\fboxsep - 2\fboxrule}
			\centering


\setlength\parskip{0.5em} % Afstand mellem linjer

\textbf{I3-GFV}

Nanna Friis-Nielsen -- 201507456


\end{minipage}}
\par}
% END: ASB Top Macro

\begin{document}
	
\chapter{MSE øvelse 6 - støj og båndbredde i forstærker}

\section{Indledning}
I MSE øvelse 6 vil vi tilslutte vores forstærker fra semester projekt til PSOC5LP ADC. Vi vil undersøge støj i kredsløbet og i ADC'en i PSoC'en.

I kredsløbet nedenfor på \cref{fig:kreds1} har vi forskellige støjkilder, som der skal tages højde for. Udgangssignalet til effektforstærkeren vil vi føre ind i PSoC'en og tilslutte ADC'en og efterfølgende et lavpasfilter med en båndbredde på 20 kHz, hvilket ca. vil svare til båndbredden for vores effektforstærker.

Vores kredsløb er som udgangspunkt påvirket af et variabelt filter, som sidder før kredsløbet. Vi ved ikke hvor stor støjtætheden er for filterkredsløbet. For overskuelighedens skyld, vælger vi at tage udgangspunkt i at der ingen støj kommer fra filterkredsløbet. På denne måde kan vi regne støjen fra vores eget kredsløb og på denne måde sætte et krav til filterkredsløbet, så at støjen derfra ikke har nogen betydning. Hvis støjbidraget fra filterkredsløbet er $\frac{1}{3}$ af støjtætheden fra vores kredsløb, vil det kun have meget lille betydning.

De støjkilder der er relevante at regne på for vores kredsløb er:

\begin{itemize}
	\item Modstand R1 og R2
	\item OpAmp U1A
	\item Modstand R3
	\item Modstand R4
	\item OpAmp U1B
	\item ADC'en i PSoC'en.	
\end{itemize}

Kondensatorerne er reaktive komponenter og vil ikke have en påvirkning på støjen. Kun kondensatorernes reelle impedans vil have en indvirkning, men den er så lille at vi kan se bort fra den. Typisk 0.1 $\Omega$.
R5's støjbidrag vælger vi at se bort fra da vores opamp har den funktion at den vedligeholder udgangsspændingen, og dermed er støjen her reguleret af OpAmpen.


For at vi til sidst kan finde vores worst-case scenario, skal vi finde den begrænsende båndbredde. Vi regner med at have en begrænsende båndbredde på 20 kHz fra vores filter i PSoC'en og vores OpAmps $\frac{1}{f}$ støj vil ikke have en kæmpe betydning for det samlede bidrag. Vi vælger dog at tage den med på en forsimplet måde. Nærmere beskrivelse følger.

Når vi nu kender de interessante støjbidrag, kan vi regne kredsløbet igennem for at finde den resulterende støj.

Det er interessant at bemærke at U1B dæmper frem for forstærker. Tilbagekoblingen vil resulterer i en dæmpningsfaktor på 0.2. $\frac{R4}{R3}$.
OpAmpens støjs gainfaktor er givet ved $\frac{R4+R3}{R3}$. Dermed bliver støjen altså forstærket med 1.2.
Dette resulterer i at alle vores støjtætheds bidrag før U1B vil ganges med 0.2.

\section{Analyse}

\begin{figure}[ht] % (alternativt [H])
	\centering
	\includegraphics[width=\textwidth]{figure/kreds1}
	\caption{Forstærker kredsløb}
	\label{fig:kreds1}
\end{figure}
Figur \ref{fig:kreds1} viser kredsløbet for vores forstærker. Forstærkerens gain faktor varieres fra afstandssensoren R3, men i vores testopstilling har vi en fast gainfaktor for U1B på 0.2, da dette vil være vores worst case scenario. R3 = 5 $\si{\kilo\Omega}$. R4 = 1 $\si{\kilo\Omega}$.




\subsection{Støj fra modstandene R1, R2, R3 og R4}


\begin{figure}[ht] % (alternativt [H])
	\centering
	\includegraphics[width=0.5\textwidth]{figure/modstandsstoej}
	\caption{Støj fra modstandene}
	\label{fig:modstandsstoej}
\end{figure}



\subsection{Støj fra OpAmp U1A og U1B}

Støj fra opamps beregnes. OpAmp U1A har en gain faktor på 1, og vi kan derfor tage dens støjbidrag direkte fra databladet. Opamp U1B, har en gain faktor på 1.2 da den beregnes ud fra formlen
$1 + \frac{R_4}{R_3}$

\begin{figure}[ht] % (alternativt [H])
	\centering
	\includegraphics[width=0.8\textwidth]{figure/opampstoej}
	\caption{Støj fra OpAmps}
	\label{fig:opampstoej}
\end{figure}









\subsection{Samlet støjbidrag før U1B}

Støjbidragene før OpAmp U1B (fra R1, R2, U1A og R3) bliver allesammen dæmpet med faktoren 0.2.
Vi kan summere de kvadrerede støjbidrag og tage roden af dette for at få det samlede bidrag.
Dermed får vi dette støjbidrag før OpAmp U1B:

\begin{figure}[ht] % (alternativt [H])
	\centering
	\includegraphics[width=0.8\textwidth]{figure/foerU1b}
	\caption{Støj før U1B}
	\label{foerU1b}
\end{figure}



\subsection{Samlet støjbidrag før ADC}


Vi kan nu finde det samlede støjbidrag, før ADC'en og opstille vores krav for filteret:

\begin{figure}[ht] % (alternativt [H])
	\centering
	\includegraphics[width=0.8\textwidth]{figure/samletstoej}
	\caption{Samlet støj før ADC}
	\label{samletstoej}
\end{figure}


Vi kan nu se på hvilke støjbidrag der rent faktisk har noget at sige for vores samlede støjbidrag. Vi kan ud fra \cref{foerU1b} konkluderer at dette støjbidrag rent faktisk ER af betydning ift. vores samlede støjbidrag før ADC'en, da denne værdi ligger i omegnen af de bidrag der bliver lagt sammen i \cref{samletstoej}. Hvis vi går endnu en tand længere tilbage i kredsløbet kan vi se at bidragene fra $\epsilon_{nU1B}$ og $\epsilon_{nU1A}$ og $R3_{taethed}$ er af ca. samme størrelse, så her kan vi ikke se bort fra nogle af dem. Der er altså ikke nogen bidrag vi kan ignorere totalt, når vi kigger på støj før ADC'en.

\subsection{Støj fra ADC'en}





\section{Simulering}

\section{Realisering}

\section{Konklusion}

\end{document}